<script>
  window.onload = function () {
    AFRAME.registerComponent("videohandler", {
      init: function () {
        const marker = this.el;
        const vid = document.querySelector("#vid");
        const boomismile = document.querySelector("#boomismile");
        const boomivid = document.querySelector("#boomivid");

        let isUserInteracted = false;

        // ä½¿ç”¨è€…é»æ“Šæ‰å…è¨±è²éŸ³
        document.body.addEventListener("click", () => {
          isUserInteracted = true;
          vid.muted = false;
          vid.play().then(() => {
            console.log("ğŸ”Š æ‰‹å‹•äº’å‹•å¾Œå·²æ’­æ”¾å½±ç‰‡");
          }).catch(e => console.warn("æ’­æ”¾å¤±æ•—ï¼š", e));
        });

        marker.addEventListener("markerFound", function () {
          console.log("ğŸ¯ Marker Found!");
          if (isUserInteracted) {
            vid.muted = false;
          }
          vid.play().catch(e => {
            console.warn("ğŸ”‡ å°šæœªäº’å‹•ç„¡æ³•æ’­æ”¾æœ‰è²å½±ç‰‡ï¼š", e);
          });
        });

        marker.addEventListener("markerLost", function () {
          vid.pause();
          vid.currentTime = 0;
        });

        vid.addEventListener("ended", function () {
          console.log("âœ… å½±ç‰‡çµæŸï¼Œé¡¯ç¤ºåœ–ç‰‡");
          boomismile.setAttribute("visible", false);
          boomivid.setAttribute("visible", false);

          const helloboomismile = document.createElement("a-image");
          helloboomismile.setAttribute("src", "#smile");
          helloboomismile.setAttribute("position", "-150 0 -1200");
          helloboomismile.setAttribute("rotation", "0 0 0");
          helloboomismile.setAttribute("width", "298");
          helloboomismile.setAttribute("height", "420");
          helloboomismile.setAttribute("look-at", "[camera]");
          document.querySelector("a-scene").appendChild(helloboomismile);
        });
      }
    });
  };
</script>
